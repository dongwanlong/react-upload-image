"use strict";angular.module("ui.ace",[]).constant("uiAceConfig",{}).directive("uiAce",["uiAceConfig",function(A){if(angular.isUndefined(window.ace)){throw new Error("ui-ace need ace to work... (o rly?)")}var B=function(E,C,F){if(angular.isDefined(F.workerPath)){var G=window.ace.require("ace/config");G.set("workerPath",F.workerPath)}if(angular.isDefined(F.require)){F.require.forEach(function(I){window.ace.require(I)})}if(angular.isDefined(F.showGutter)){E.renderer.setShowGutter(F.showGutter)}if(angular.isDefined(F.useWrapMode)){C.setUseWrapMode(F.useWrapMode)}if(angular.isDefined(F.showInvisibles)){E.renderer.setShowInvisibles(F.showInvisibles)}if(angular.isDefined(F.showIndentGuides)){E.renderer.setDisplayIndentGuides(F.showIndentGuides)}if(angular.isDefined(F.useSoftTabs)){C.setUseSoftTabs(F.useSoftTabs)}if(angular.isDefined(F.showPrintMargin)){E.setShowPrintMargin(F.showPrintMargin)}if(angular.isDefined(F.disableSearch)&&F.disableSearch){E.commands.addCommands([{name:"unfind",bindKey:{win:"Ctrl-F",mac:"Command-F"},exec:function(){return false},readOnly:true}])}if(angular.isString(F.theme)){E.setTheme("ace/theme/"+F.theme)}if(angular.isString(F.mode)){C.setMode("ace/mode/"+F.mode)}if(angular.isDefined(F.firstLineNumber)){if(angular.isNumber(F.firstLineNumber)){C.setOption("firstLineNumber",F.firstLineNumber)}else{if(angular.isFunction(F.firstLineNumber)){C.setOption("firstLineNumber",F.firstLineNumber())}}}var D,H;if(angular.isDefined(F.advanced)){for(D in F.advanced){H={name:D,value:F.advanced[D]};E.setOption(H.name,H.value)}}if(angular.isDefined(F.rendererOptions)){for(D in F.rendererOptions){H={name:D,value:F.rendererOptions[D]};E.renderer.setOption(H.name,H.value)}}angular.forEach(F.callbacks,function(I){if(angular.isFunction(I)){I(E)}})};return{restrict:"EA",require:"?ngModel",link:function(E,L,D,F){var K=A.ace||{};var J=angular.extend({},K,E.$eval(D.uiAce));var G=window.ace.edit(L[0]);var O=G.getSession();var I;var H;var M=function(){var P=arguments[0];var Q=Array.prototype.slice.call(arguments,1);if(angular.isDefined(P)){E.$evalAsync(function(){if(angular.isFunction(P)){P(Q)}else{throw new Error("ui-ace use a function as callback.")}})}};var N={onChange:function(P){return function(Q){var R=O.getValue();if(F&&R!==F.$viewValue&&!E.$$phase&&!E.$root.$$phase){E.$evalAsync(function(){F.$setViewValue(R)})}M(P,Q,G)}},onBlur:function(P){return function(){M(P,G)}}};D.$observe("readonly",function(P){G.setReadOnly(!!P||P==="")});if(F){F.$formatters.push(function(P){if(angular.isUndefined(P)||P===null){return""}else{if(angular.isObject(P)||angular.isArray(P)){throw new Error("ui-ace cannot use an object or an array as a model")}}return P});F.$render=function(){O.setValue(F.$viewValue)}}var C=function(P,Q){if(P===Q){return}J=angular.extend({},K,E.$eval(D.uiAce));J.callbacks=[J.onLoad];if(J.onLoad!==K.onLoad){J.callbacks.unshift(K.onLoad)}O.removeListener("change",I);I=N.onChange(J.onChange);O.on("change",I);G.removeListener("blur",H);H=N.onBlur(J.onBlur);G.on("blur",H);B(G,O,J)};E.$watch(D.uiAce,C,true);C(K);L.on("$destroy",function(){G.session.$stopWorker();G.destroy()});E.$watch(function(){return[L[0].offsetWidth,L[0].offsetHeight]},function(){G.resize();G.renderer.updateFull()},true)}}}]);